# AOP
- AOP (Aspect-Oriented Programming)
- 애스펙트는 로깅이나 트랜잭선과 같이 횡단 관심사의 관점으로 보는 것이다. 애스펙트를 사용한 프로그래밍 방식을 관점 지향 프로그래밍, AOP라고 한다.
- 대표적인 AOP 구현으로는 AspectJ 프레임워크가 있다. 스프링도 AOP를 지원하지만 대부분 AspectJ의 문법을 차용하고, AspectJ가 더 많은 기능을 제공한다.

# AOP 적용 방식

## 컴파일 시점
- AspectJ가 제공하는 컴파일러를 사용해 java 코드를 컴파일해서 class로 만드는 시점에 부가 기능을 추가한다.
- 원본 로직에 부가 기능을 호출하는 코드를 실제로 붙여 준다고 생각하면 된다.
- 원본 로직에 부가 기능 로직이 추가되는 것을 위빙(Weaving)이라고 한다.
- 단점 : 특별한 컴파일러가 필요하고 복잡하다.

## 클래스 로딩 시점
- 자바를 실행하고 class 파일이 JVM의 클래스 로더에 올라갈 때, 중간에서 클래스 로더 조작기를 통해 class 파일을 조작하여 부가 기능을 추가한다.
- 이 시점에 애스펙트를 적용하는 것을 로드 타임 위빙이라고 한다.
- 단점 : 자바 실행시 특별한 옵션을 통해 클래스 로더 조작기를 지정해야 하는데, 이 부분이 번거롭고 운영하기 어렵다.

## 런타임 시점
- 자바의 main 메서드가 실행되고 나서 부가 기능이 적용된다. 
- 자바 언어가 제공하는 범위 내에서 부가기능을 적용해야 하므로 스프링 컨테이너, 프록시, DI, 빈 후처리기 등을 사용해야 한다. 최종적으로는 프록시를 통해 스프링 빈에 부가 기능을 적용하게 된다.
- 프록시 방식을 사용하기 때문에 제약이 존재하지만, 특별한 컴파일러나 클래스 로더 조작기 등을 설정하지 않아도 된다.

# AOP 적용 위치
- AOP를 적용할 수 있는 지점을 조인 포인트라고 한다. 
- 컴파일 시점, 클래스 로딩 시점에 AspectJ를 사용해서 AOP를 적용하는 경우, 바이트코드를 조작하기 때문에 모든 지점에 AOP를 적용할 수 있다.
- 프록시 방식의 AOP에서는 메서드 실행 지점에만 AOP를 적용할 수 있다. (프록시는 메서드 오버라이딩을 사용해 동작하기 때문) 그리고 스프링 빈에만 AOP를 적용할 수 있다.

# AOP 용어 정리

**조인 포인트 (Join Point)**

- 어드바이스가 적용될 수 있는 지점 (생성자 호출, 필드값 접근, static 메서드, 메서드 실행 등)

**포인트컷 (Pointcut)**

- 조인 포인트 중에서 어드바이스가 적용될 위치를 판단하는 기능
- 주로 AspectJ 표현식을 사용해서 지정


**타겟 (Target)**

- 어드바이스가 적용되는 대상 객체로, 포인트컷으로 결정된다.

**어드바이스 (Advice)**

- 부가 기능
- Around, Before, After와 같은 다양한 종류가 있다.

**애스펙트 (Aspect)**

- 어드바이스 + 포인트컷을 모듈화한 것
- `@Aspect`를 생각하면 된다. 
- 여러 어드바이스와 포인트컷이 함께 존재한다.

**어드바이저 (Advisor)**

- 하나의 어드바이스 + 하나의 포인트컷
- 스프링 AOP에서만 사용되는 용어이다.

**위빙 (Weaving)**

- 포인트컷으로 결정된 타겟의 조인포인트에 어드바이스를 적용하는 것
- 핵심 기능 코드에 영향을 주지 않고 부가 기능을 추가할 수 있게 해준다.

**AOP 프록시**

- AOP 기능을 구현하기 위해 만든 프록시 객체로, 스프링에서는 JDK 동적 프록시 또는 CGLIB 프록시가 만들어진다.

